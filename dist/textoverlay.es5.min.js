!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Textoverlay=t():e.Textoverlay=t()}(window,function(){return o={},a.m=r=[function(e,t){"use strict";function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(t,"__esModule",{value:!0});var a={backdrop:{"box-sizing":"border-box",position:"absolute",margin:"0px"},overlay:{"box-sizing":"border-box","border-color":"transparent","border-style":"solid",color:"transparent",position:"absolute","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden",margin:"0px"},textarea:{background:"transparent"}},n={background:["background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-position-x","background-position-y","background-repeat","background-size"],overlay:["font-family","font-size","font-weight","line-height","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width"]},r=(function(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}(i,[{key:"destroy",value:function(){window.removeEventListener("resize",this.resizeListener),this.textarea.removeEventListener("input",this.handleInput),this.textarea.removeEventListener("scroll",this.handleScroll),this.observer.disconnect(),this.overlay.remove(),this.backdrop.remove(),s(this.textarea,this.textareaStyleWas)}},{key:"render",value:function(e){0<arguments.length&&void 0!==e&&e||this.updateOverlayNodes(),this.syncStyles()}},{key:"updateOverlayNodes",value:function(){var t=this;this.overlay.innerHTML="",this.overlayPositioner=document.createElement("div"),this.overlayPositioner.className="textoverlay-positioner",this.overlayPositioner.style.display="block",this.overlay.appendChild(this.overlayPositioner),this.computeOverlayNodes().forEach(function(e){t.overlay.appendChild(e)})}},{key:"syncStyles",value:function(){var e=this.textarea.offsetTop,t=this.textarea.offsetLeft,r=this.textarea.offsetHeight,o=this.textarea.clientWidth+parseInt(this.textareaStyle.borderLeftWidth||"0",10)+parseInt(this.textareaStyle.borderRightWidth||"0",10),a=this.textarea.scrollTop,n=null!==this.textareaStyle.zIndex&&"auto"!==this.textareaStyle.zIndex?+this.textareaStyle.zIndex:0;this.backdrop.style.zIndex=""+(n-2),this.overlay.style.zIndex=""+(n-1),this.backdrop.style.left=this.overlay.style.left=t+"px",this.backdrop.style.top=this.overlay.style.top=e+"px",this.backdrop.style.height=this.overlay.style.height=r+"px",this.backdrop.style.width=this.overlay.style.width=o+"px",this.setOverlayScroll(a)}},{key:"setOverlayScroll",value:function(e){null!==this.overlayPositioner&&(this.overlayPositioner.style.marginTop="-"+e+"px")}},{key:"computeOverlayNodes",value:function(){return this.strategies.reduce(function(e,a){var n=document.createElement("span");s(n,a.css);var i=[];return e.forEach(function(e){if(e.nodeType===Node.TEXT_NODE)for(var t=e.textContent||"";;){var r=a.match.lastIndex,o=a.match.exec(t);if(!o){0===r?t&&i.push(e):r<t.length&&i.push(document.createTextNode(t.slice(r)));break}o=o[0],r=t.slice(r,a.match.lastIndex-o.length);r&&i.push(document.createTextNode(r)),o&&((r=n.cloneNode(!1)).textContent=o,i.push(r))}else i.push(e)}),i},[document.createTextNode(this.textarea.value)])}},{key:"handleInput",value:function(){this.render()}},{key:"handleScroll",value:function(){this.setOverlayScroll(this.textarea.scrollTop)}},{key:"copyTextareaStyle",value:function(t,e){var r=this;e.forEach(function(e){t.style.setProperty(e,r.textareaStyle.getPropertyValue(e))})}}]),i);function i(e,t){var r=this;if(!function(e){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this),(this.overlayPositioner=null)===e.parentElement)throw new Error("textarea must be in the DOM tree");this.textarea=e,this.textareaStyle=window.getComputedStyle(e),this.backdrop=document.createElement("div"),this.backdrop.className="textoverlay-backdrop",s(this.backdrop,a.backdrop),this.copyTextareaStyle(this.backdrop,n.background),this.textarea.parentElement.insertBefore(this.backdrop,this.textarea),this.overlay=document.createElement("div"),this.overlay.className="textoverlay",s(this.overlay,a.overlay),this.copyTextareaStyle(this.overlay,n.overlay),this.textarea.parentElement.insertBefore(this.overlay,this.textarea),this.syncStyles(),this.textareaStyleWas={},Object.keys(a.textarea).forEach(function(e){r.textareaStyleWas[e]=r.textarea.style.getPropertyValue(e)}),s(this.textarea,a.textarea),this.strategies=t,this.textarea.addEventListener("input",this.handleInput),this.textarea.addEventListener("scroll",this.handleScroll),this.observer=new MutationObserver(function(){r.syncStyles()}),this.observer.observe(this.textarea,{attributes:!0,attributeFilter:["style"]}),this.resizeListener=this.syncStyles,window.addEventListener("resize",this.resizeListener),this.render()}function s(t,r){Object.keys(r).forEach(function(e){t.style.setProperty(e,r[e])})}t.default=r}],a.c=o,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(r,o,function(e){return t[e]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0).default;function a(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}var r,o});
//# sourceMappingURL=textoverlay.es5.min.js.map